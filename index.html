<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>AquaFuture Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-deep: #020b14;
        --accent-cyan: #00f2ff;
        --accent-blue: #0077ff;
        --text-main: #e0f7fa;
        --glass: rgba(2, 11, 20, 0.6);
        --glass-border: rgba(0, 242, 255, 0.15);
        --font-main: "Rajdhani", sans-serif;
      }

      * {
        box-sizing: border-box;
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: var(--font-main);
        background-color: var(--bg-deep);
        color: var(--text-main);
      }

      /* --- BACKGROUND ANIMATION --- */
      .bg-layer {
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle at center, #0b2d4f 0%, #020b14 60%);
        z-index: -2;
        transition: transform 0.1s ease-out;
      }

      .water-effect {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          135deg,
          transparent 0%,
          rgba(0, 242, 255, 0.03) 50%,
          transparent 100%
        );
        z-index: -1;
        animation: shimmer 8s infinite linear;
        pointer-events: none;
      }

      @keyframes shimmer {
        0% {
          opacity: 0.3;
          transform: translateY(0) scale(1);
        }
        50% {
          opacity: 0.6;
          transform: translateY(-10px) scale(1.02);
        }
        100% {
          opacity: 0.3;
          transform: translateY(0) scale(1);
        }
      }

      /* --- LAYOUT --- */
      .app-container {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 100%;
        padding: 20px;
        position: relative;
        z-index: 1;
      }

      /* --- HEADER & SETTINGS BUTTONS --- */
      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
      }

      .icon-btn {
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid var(--glass-border);
        border-radius: 50%;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .icon-btn svg {
        width: 20px;
        height: 20px;
        fill: var(--accent-cyan);
        filter: drop-shadow(0 0 5px var(--accent-cyan));
      }

      .icon-btn:active {
        transform: scale(0.9);
        background: rgba(0, 242, 255, 0.1);
      }

      /* --- MAIN CENTER DISPLAY --- */
      .center-display {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        position: relative;
      }

      .progress-circle-container {
        position: relative;
        width: 260px;
        height: 260px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
      }

      .progress-ring {
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
      }

      .progress-ring__circle-bg {
        stroke: rgba(255, 255, 255, 0.05);
      }

      .progress-ring__circle {
        stroke: var(--accent-cyan);
        stroke-dasharray: 754; /* 2 * PI * 120 */
        stroke-dashoffset: 754;
        transition: stroke-dashoffset 0.5s ease-in-out;
        filter: drop-shadow(0 0 8px var(--accent-cyan));
      }

      .percentage-text {
        position: absolute;
        font-size: 4rem;
        font-weight: 700;
        background: linear-gradient(to bottom, #fff, var(--accent-cyan));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
      }

      .info-text {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.7);
        letter-spacing: 1px;
        margin-top: -10px;
      }

      /* --- CONTROLS --- */
      .controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 30px;
        margin-bottom: 40px;
      }

      .btn-action {
        border: none;
        color: #fff;
        cursor: pointer;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: var(--font-main);
        transition: transform 0.2s, box-shadow 0.2s;
        backdrop-filter: blur(5px);
      }

      .btn-minus {
        width: 50px;
        height: 50px;
        background: rgba(255, 50, 50, 0.1);
        border: 1px solid rgba(255, 50, 50, 0.3);
      }

      .btn-minus svg {
        fill: #ff4d4d;
        width: 20px;
      }

      .btn-plus {
        width: 80px;
        height: 80px;
        background: rgba(0, 242, 255, 0.1);
        border: 1px solid var(--accent-cyan);
        box-shadow: 0 0 15px rgba(0, 242, 255, 0.2);
      }

      .btn-plus svg {
        fill: var(--accent-cyan);
        width: 32px;
      }

      .btn-label {
        position: absolute;
        bottom: -25px;
        font-size: 0.8rem;
        opacity: 0.6;
      }

      .btn-plus:active {
        transform: scale(0.95);
        box-shadow: 0 0 25px rgba(0, 242, 255, 0.4);
      }
      .btn-minus:active {
        transform: scale(0.95);
      }

      /* --- MODALS --- */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(2, 11, 20, 0.9);
        backdrop-filter: blur(15px);
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .modal.active {
        opacity: 1;
        pointer-events: auto;
      }

      .modal-content {
        width: 85%;
        max-width: 400px;
        background: rgba(10, 25, 40, 0.8);
        border: 1px solid var(--glass-border);
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        text-align: center;
      }

      .modal h2 {
        margin-top: 0;
        color: var(--accent-cyan);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .input-group {
        margin: 20px 0;
        text-align: left;
      }

      .input-group label {
        display: block;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 5px;
      }

      .input-field {
        width: 100%;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid var(--glass-border);
        color: #fff;
        padding: 12px;
        border-radius: 8px;
        font-family: var(--font-main);
        font-size: 1.1rem;
      }

      .btn-save,
      .btn-reset {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-family: var(--font-main);
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        margin-top: 10px;
        text-transform: uppercase;
      }

      .btn-save {
        background: var(--accent-cyan);
        color: #000;
        box-shadow: 0 0 10px rgba(0, 242, 255, 0.3);
      }

      .btn-reset {
        background: rgba(255, 50, 50, 0.1);
        border: 1px solid rgba(255, 50, 50, 0.3);
        color: #ff8888;
        margin-top: 15px;
      }

      .close-modal {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.5);
        font-size: 1.5rem;
        cursor: pointer;
      }

      .stats-list {
        list-style: none;
        padding: 0;
        text-align: left;
        max-height: 200px;
        overflow-y: auto;
      }

      .stats-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.9rem;
      }

      .stats-date {
        opacity: 0.7;
      }
      .stats-val {
        color: var(--accent-cyan);
      }
    </style>
  </head>
  <body>
    <div class="bg-layer" id="parallaxBg"></div>
    <div class="water-effect"></div>

    <div class="app-container">
      <div class="top-bar">
        <button class="icon-btn" onclick="openModal('statsModal')">
          <svg viewBox="0 0 24 24">
            <path
              d="M3 3v18h18v-2H5V3H3zm4 14h2v-4H7v4zm4 0h2V7h-2v10zm4 0h2v-7h-2v7z"
            />
          </svg>
        </button>
        <button class="icon-btn" onclick="openModal('settingsModal')">
          <svg viewBox="0 0 24 24">
            <path
              d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"
            />
          </svg>
        </button>
      </div>

      <div class="center-display">
        <div class="progress-circle-container">
          <svg class="progress-ring" width="260" height="260">
            <circle
              class="progress-ring__circle-bg"
              stroke-width="12"
              fill="transparent"
              r="120"
              cx="130"
              cy="130"
            />
            <circle
              class="progress-ring__circle"
              id="progressCircle"
              stroke-width="12"
              stroke-linecap="round"
              fill="transparent"
              r="120"
              cx="130"
              cy="130"
            />
          </svg>
          <div class="percentage-text" id="percentDisplay">0%</div>
        </div>
        <div class="info-text">
          <span id="currentAmount">0</span> /
          <span id="goalAmount">2500</span> ml
        </div>
      </div>

      <div class="controls">
        <div style="position: relative">
          <button class="btn-action btn-minus" onclick="addWater('subtract')">
            <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z" /></svg>
          </button>
        </div>

        <div style="position: relative">
          <button class="btn-action btn-plus" onclick="addWater('add')">
            <svg viewBox="0 0 24 24">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
            </svg>
          </button>
          <div
            class="btn-label"
            style="width: 100%; text-align: center; color: var(--accent-cyan)"
          >
            +<span id="glassSizeLabel">250</span>ml
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="settingsModal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal('settingsModal')">
          &times;
        </button>
        <h2>Настройки</h2>
        <div class="input-group">
          <label>Ваш вес (кг):</label>
          <input
            type="number"
            id="weightInput"
            class="input-field"
            placeholder="70"
            onchange="calculateGoal()"
          />
          <div style="font-size: 0.8rem; opacity: 0.5; margin-top: 5px">
            Норма: ~35мл на 1кг
          </div>
        </div>
        <div class="input-group">
          <label>Размер стакана (мл):</label>
          <input
            type="number"
            id="glassInput"
            class="input-field"
            placeholder="250"
          />
        </div>
        <button class="btn-save" onclick="saveSettings()">Сохранить</button>
      </div>
    </div>

    <div class="modal" id="statsModal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal('statsModal')">
          &times;
        </button>
        <h2>Статистика</h2>
        <ul class="stats-list" id="statsList"></ul>
        <button class="btn-reset" onclick="resetToday()">
          Сбросить сегодня
        </button>
        <button
          class="btn-reset"
          style="border-color: #ff3333; color: #ff3333"
          onclick="resetAll()"
        >
          Полный сброс
        </button>
      </div>
    </div>

    <script>
      // --- CONFIG & STATE ---
      const CONSTANTS = {
        ML_PER_KG: 35,
        DEFAULT_WEIGHT: 70,
        DEFAULT_GLASS: 250,
        CIRCLE_RADIUS: 120,
      };

      let state = {
        current: 0,
        goal: 2450,
        weight: 70,
        glassSize: 250,
        lastDate: new Date().toDateString(),
        history: [],
      };

      const circle = document.getElementById("progressCircle");
      const circumference = 2 * Math.PI * CONSTANTS.CIRCLE_RADIUS;

      // --- INIT ---
      function init() {
        // Setup circle
        circle.style.strokeDasharray = `${circumference} ${circumference}`;

        // Load Data
        const saved = localStorage.getItem("aquaTrackerData");
        if (saved) {
          state = JSON.parse(saved);
        }

        // Check Date
        const today = new Date().toDateString();
        if (state.lastDate !== today) {
          // Save yesterday to history
          if (state.current > 0) {
            state.history.unshift({
              date: state.lastDate,
              amount: state.current,
              goal: state.goal,
            });
            if (state.history.length > 7) state.history.pop(); // Keep last 7 days
          }
          state.current = 0;
          state.lastDate = today;
          saveData();
        }

        // Update UI
        document.getElementById("weightInput").value = state.weight;
        document.getElementById("glassInput").value = state.glassSize;
        calculateGoal(false); // Recalc goal based on weight just in case
        updateUI();

        // Setup Parallax
        window.addEventListener("mousemove", handleParallax);
        window.addEventListener("deviceorientation", handleMobileParallax);
      }

      // --- CORE LOGIC ---
      function calculateGoal(save = true) {
        const w =
          parseFloat(document.getElementById("weightInput").value) ||
          CONSTANTS.DEFAULT_WEIGHT;
        state.weight = w;
        state.goal = Math.round(w * CONSTANTS.ML_PER_KG);
        if (save) updateUI();
      }

      function saveSettings() {
        const w = parseFloat(document.getElementById("weightInput").value);
        const g = parseFloat(document.getElementById("glassInput").value);

        if (w) state.weight = w;
        if (g) state.glassSize = g;

        state.goal = Math.round(state.weight * CONSTANTS.ML_PER_KG);

        closeModal("settingsModal");
        saveData();
        updateUI();
      }

      function addWater(type) {
        const amount = state.glassSize;
        if (type === "add") {
          state.current += amount;
        } else {
          state.current -= amount;
          if (state.current < 0) state.current = 0;
        }
        saveData();
        updateUI();
      }

      function updateUI() {
        // Texts
        document.getElementById("currentAmount").textContent = state.current;
        document.getElementById("goalAmount").textContent = state.goal;
        document.getElementById("glassSizeLabel").textContent = state.glassSize;

        // Percentage & Circle
        let percent = Math.round((state.current / state.goal) * 100);
        // Cap visual percent at 100 for circle, but show number higher
        const visualPercent = percent > 100 ? 100 : percent;

        document.getElementById("percentDisplay").textContent = `${percent}%`;

        const offset = circumference - (visualPercent / 100) * circumference;
        circle.style.strokeDashoffset = offset;

        // Stats
        renderStats();
      }

      function renderStats() {
        const list = document.getElementById("statsList");
        list.innerHTML = "";

        if (state.history.length === 0) {
          list.innerHTML =
            '<li style="opacity:0.5; text-align:center;">История пуста</li>';
          return;
        }

        state.history.forEach((item) => {
          const li = document.createElement("li");
          li.className = "stats-item";
          const p = Math.round((item.amount / item.goal) * 100);
          li.innerHTML = `
                    <span class="stats-date">${item.date}</span>
                    <span class="stats-val">${item.amount} мл (${p}%)</span>
                `;
          list.appendChild(li);
        });
      }

      function resetToday() {
        if (confirm("Сбросить выпитое за сегодня?")) {
          state.current = 0;
          saveData();
          updateUI();
          closeModal("statsModal");
        }
      }

      function resetAll() {
        if (confirm("Удалить вообще все данные и настройки?")) {
          localStorage.removeItem("aquaTrackerData");
          location.reload();
        }
      }

      function saveData() {
        localStorage.setItem("aquaTrackerData", JSON.stringify(state));
      }

      // --- UTILS ---
      function openModal(id) {
        document.getElementById(id).classList.add("active");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }

      // --- ANIMATION EFFECTS ---
      function handleParallax(e) {
        const x = (window.innerWidth - e.pageX * 2) / 50;
        const y = (window.innerHeight - e.pageY * 2) / 50;
        document.getElementById(
          "parallaxBg"
        ).style.transform = `translateX(${x}px) translateY(${y}px)`;
      }

      function handleMobileParallax(e) {
        const x = e.gamma ? e.gamma / 2 : 0;
        const y = e.beta ? e.beta / 2 : 0;
        document.getElementById(
          "parallaxBg"
        ).style.transform = `translateX(${x}px) translateY(${y}px)`;
      }

      // Run
      init();
    </script>
  </body>
</html>
